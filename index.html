<!DOCTYPE html>
<html>

<head>

    <!-- Lägg till denna länk i din head-tagg -->
    <link href="https://fonts.googleapis.com/css2?family=Indie+Flower&display=swap" rel="stylesheet">


    <style>
        body,
        html {
            height: 100%;
            margin: 0;
            font-family: 'Indie Flower', cursive;
        }

        .background-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('/tallriken/images/matbakgrund1.jpeg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            z-index: -1;
        }


        .blur-background .background-container {
            filter: blur(5px);
        }



        .search-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            z-index: 2000;
            width: 40%;
            /* Ökar bredden av sökfältet */
        }

        .slider-button-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 10px;
            /* Justera avståndet mellan sliders och sökfält */
        }

        .input-button-container {
            display: flex;
            width: 100%;
        }

        .input-button-container input[type='text'] {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #ddd;
            background-color: white;
            color: black;
            outline: none;
            border-radius: 25px 0 0 25px;
            /* Avrundade hörn till vänster (både upp och ner) */
        }

        .input-button-container button {
            padding: 10px 20px;
            border: 1px solid #ddd;
            background-color: white;
            color: black;
            outline: none;
            cursor: pointer;
            border-radius: 0;
            /* Inga avrundade hörn */
            border-left: none;
            /* Ta bort vänster gräns för att smälta ihop med föregående element */
        }

        .input-button-container button:last-child {
            border-radius: 0 25px 25px 0;
            /* Avrundade hörn till höger (både upp och ner) */
        }


        #data-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            margin-top: 25%;
            padding-bottom: 50px;
            overflow: auto;
        }

        .matratt {
            flex: 0 0 calc(33.33% - 20px);
            max-width: calc(33.33% - 20px);
            margin: 10px;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-sizing: border-box;
            align-self: flex-start;
            position: relative;
        }

        .matratt iframe {
            width: 100%;
            height: 750px;
            overflow-y: auto;
            display: block;
            border: none;
            transform: scale(0.65);
            transform-origin: top center;
        }

        .matratt-title {
            background-color: rgba(255, 255, 255, 0.8);
            padding: 10px;
            margin: 5px 0;
            border-radius: 10px;
        }

        .matratt-ingredienser div {
            position: absolute;
            left: 0;
            animation: ticker 20s linear infinite;
        }

        .ingrediens-knapp {
            background-color: #f2f2f2;
            border: none;
            padding: 5px 10px;
            margin-top: 5px;
            cursor: pointer;
            border-radius: 5px;
            font-size: 0.9em;
        }

        .ingrediens-lista {
            display: none;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            position: absolute;
            top: 40px;
            left: 0;
            right: 0;
            z-index: 10;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            max-height: 200px;
            overflow-y: auto;
        }

        @keyframes ticker {
            0% {
                left: 100%;
            }

            100% {
                left: -100%;
            }
        }

        .instagram-media iframe {
            width: 100%;
            min-height: 500px;
            display: block;
        }

        .matratt h2,
        .matratt p,
        .matratt a {
            margin: 5px 0;
        }

        @media (max-width: 768px) {
            .matratt {
                flex: 0 0 calc(50% - 20px);
                max-width: calc(50% - 20px);
            }
        }

        @media (max-width: 480px) {
            .matratt {
                flex: 0 0 calc(100% - 20px);
                max-width: calc(100% - 20px);
            }
        }

        .matratt {
            width: calc(100% - 20px);
            /* En kolumn för mycket små skärmar */
        }


        /* Lägg till den nya CSS-koden för footer-banner här */
        .footer-banner {
            background-color: #000;
            color: white;
            text-align: center;
            padding: 10px 20px;
            position: fixed;
            bottom: 0;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .footer-banner a {
            color: white;
            text-decoration: none;
            margin: 0 10px;
        }

        .footer-banner a:hover {
            text-decoration: underline;
        }

        .footer-links {
            display: flex;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
        }

        /* Stil för copyright-texten */
        .footer-banner p {
            margin: 0;
            color: white;
            flex-grow: 1;
            text-align: left;
        }

        .tag-container {
            display: flex;
            flex-wrap: wrap;
            width: 100%;
            /* Matcha bredden med sökfältet */
            padding: 5px;
            border-radius: 0 0 25px 25px;
            /* Behåll rundade hörn endast på botten om så önskas */
            margin-top: 0;
            /* Ta bort mellanrummet mellan fält och taggar */
            /* Ta bort border-egenskapen för att eliminera den vita konturen */
        }

        #data-container {
            display: flex;
            flex-wrap: wrap;
            /* Resten av din CSS för #data-container */
        }

        .tag {
            position: relative;
            background-color: #ddd;
            padding: 5px 10px;
            margin-right: 5px;
            border-radius: 3px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;

        }

        .tag-close {
            margin-left: 5px;
            cursor: pointer;
            border: none;
            background: transparent;
            font-size: 1rem;
        }

        .hidden-search {
            transform: translateY(-100%);
            transition: transform 0.3s;
            display: none;
        }

        .blur-background {
            filter: blur(5px);
        }

        .logo-link {
            position: fixed;
            top: 10px;
            /* Justera avståndet från toppen */
            left: 10px;
            /* Justera avståndet från vänsterkanten */
            z-index: 3000;
            /* Se till att loggan alltid är överst */
        }

        .logo-link img {
            height: 50px;
            /* Justera storleken på loggan */
            width: auto;
            /* Behåller bildens aspektförhållande */
        }

        .matratt-title,
        .ingrediens-knapp,
        .ingrediens-lista {
            color: white;
            /* Vit text */
            background-color: rgba(0, 0, 0, 0.8);
            /* Svart bakgrund */
        }

        /* Stilen för omkopplaren */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            /* Bredden på omkopplaren */
            height: 34px;
            /* Höjden på omkopplaren */
        }

        /* "Slider" */
        .switch .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            /* Bakgrundsfärg för slider när den är av */
            -webkit-transition: .4s;
            transition: .4s;
        }

        .switch .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            /* Höjden på den vita delen som glider */
            width: 26px;
            /* Bredden på den vita delen som glider */
            left: 4px;
            bottom: 4px;
            background-color: white;
            -webkit-transition: .4s;
            transition: .4s;
        }

        input:checked+.slider {
            background-color: #03ba11;
            /* Färg när omkopplaren är på */
        }

        input:focus+.slider {
            box-shadow: 0 0 1px #03ba11;
        }

        input:checked+.slider:before {
            -webkit-transform: translateX(26px);
            -ms-transform: translateX(26px);
            transform: translateX(26px);
        }

        /* Rundade kanter på omkopplaren */
        .slider.round {
            border-radius: 34px;
        }

        .slider.round:before {
            border-radius: 50%;
        }

        /* Anpassning för den stora slidern */
        .switch.large {
            width: 60px;
            /* Bredden på omkopplaren */
            height: 34px;
            /* Höjden på omkopplaren */
        }

        .switch.large .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            /* Background color when switch is off */
            transition: .4s;
            border-radius: 34px;
            /* Rounded corners for the switch */
        }

        /* Stil för "knappen" på slidern */
        .switch.large .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            /* Höjden på den rörliga delen */
            width: 26px;
            /* Bredden på den rörliga delen, gör den rund */
            left: 4px;
            /* Position från vänster */
            bottom: 4px;
            /* Centrera vertikalt */
            background-color: white;
            /* Färg på "knappen" */
            transition: .4s;
            border-radius: 50%;
            /* Gör den helt rund */
        }

        input:checked+.switch.large .slider {
            background-color: #4caf50;
            /* Color when switch is on */
        }

        input:checked+.switch.large .slider:before {
            -webkit-transform: translateX(26px);
            -ms-transform: translateX(26px);
            transform: translateX(calc(100% - 30px));
            /* Flytta knappen till höger kant */
        }

        /* Stiljusteringar för textetiketterna för slidern */
        .search-mode-label {
            display: block;
            font-family: 'Indie Flower', cursive;
            color: white;
            background-color: rgba(0, 0, 0, 0.7);
            text-align: center;
            padding: 5px;
            border-radius: 5px;
            margin: 0 5px;
            /* Utrymme runt etiketterna */
            /* Ytterligare stilinställningar efter behov */
        }

        /* Säkerställ att texten är centrerad vertikalt */
        .search-mode-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 0;
        }


        input:checked+.slider.large {
            background-color: #0075fe;
            /* Grön färg när slidern är till höger */
        }

        input:not(:checked)+.slider.large {
            background-color: #0075fe;
            /* Röd färg när slidern är till vänster */
        }

        .veg-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-left: 10px;
            /* Justera detta värde efter behov */
        }

        .veg-label {
            background-color: rgba(0, 0, 0, 0.7);
            /* Svart med lite transparens */
            color: white;
            padding: 5px;
            margin-bottom: 5px;
            /* Uttrymme mellan etiketten och slidern */
            text-align: center;
            border-radius: 5px;
        }

        .lang-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-left: 10px;
        }

        .lang-label {
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px;
            margin-bottom: 5px;
            text-align: center;
            border-radius: 5px;
        }
    </style>
</head>

<body>

    <a href="index.html" class="logo-link">
        <img src="images/testlogga2.png" alt="Logga" />
    </a>

    <div class="background-container"></div>


    <div class="search-container">
        <!-- Ny slider här -->
        <div class="search-mode-container">
            <div class="search-mode-label">Sök på ingredienser</div>
            <label class="switch large">
                <input type="checkbox" id="searchModeSwitch" onchange="toggleSearchMode()">
                <span class="slider round large"></span>
            </label>
            <div class="search-mode-label">Sök på maträtt</div>
        </div>
        <!-- Slider-knappar ovanför sökfältet -->
        <div class="slider-button-container">
            <div class="veg-container">
                <div class="veg-label">Bara Veg</div>
                <label class="switch">
                    <input type="checkbox" id="vegSwitch" onchange="toggleVegFilter()">
                    <span class="slider round"></span>
                </label>
            </div>
            <div class="lang-container">
                <div class="lang-label">Bara recept på svenska</div>
                <label class="switch">
                    <input type="checkbox" id="langSwitch" onchange="toggleLangFilter()">
                    <span class="slider round"></span>
                </label>
            </div>
        </div>

        <!-- Sökfält och knappar -->
        <div class="input-button-container">
            <input type="text" id="searchInput" placeholder="Skriv ingredienser eller maträtt och tryck Enter...">
            <button onclick="addTagFromButton()">Lägg till</button> <!-- Ny knapp för att lägga till taggar -->
            <button onclick="performSearch()">Sök</button>
        </div>

        <!-- Taggarna här -->
        <div class="tag-container"></div>
    </div>



    <div id="data-container"></div>
    <div class="footer-banner">
        <!-- Footer content -->
        <!-- Innehåll för din banner, t.ex. Om Oss och Tipsa Oss länkar -->
    </div>

    <script>
        let allData = [];
        let selectedTags = [];
        let isVegFilterActive = false;
        let isLangFilterActive = false;
        let ingredientSynonyms = {};
        let searchForDishes = false; // eller true, beroende på din standardinställning



        async function loadData() {
            const apiKey = 'AIzaSyBFecFz9KFsPnw6bjAKv0N0CSbs3Iszlag';
            const spreadsheetId = '1RN9SQRzletJnH8BAgJEQCI0BtbpsHQU6Pv2L4FDGXEM';
            const range = 'Blad1!A1:J'; // Include columns I and J
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}?key=${apiKey}`;

            try {
                const response = await fetch(url);
                const data = await response.json();
                allData = data.values.slice(1); // Ignore the header row

                // Create a synonym mapping
                ingredientSynonyms = {}; // Reset the mapping object
                data.values.forEach((row, index) => {
                    if (index === 0) return; // Skip header row
                    const ingredient = row[8]?.toLowerCase().trim(); // Column I
                    const synonyms = row[9] ? row[9].toLowerCase().split(',').map(s => s.trim()) : []; // Column J
                    synonyms.forEach(syn => {
                        ingredientSynonyms[syn] = ingredient;
                    });
                });
                console.log('Synonyms loaded:', ingredientSynonyms);
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }

        function performSearch() {
            let searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();

            let filteredData = allData.filter(row => {
                if (searchForDishes) {
                    // Sök endast på maträttens namn
                    return row[0]?.toLowerCase().includes(searchTerm);
                } else {
                    // Sök på ingredienser
                    const ingredients = row[1]?.toLowerCase().split(',').map(ing => ing.trim());
                    if (selectedTags.length > 0) {
                        // Kontrollera att alla taggar finns i ingredienslistan
                        return selectedTags.every(tag => ingredients.includes(tag.toLowerCase()));
                    } else {
                        // Om inga taggar är valda, använd söktermen
                        return ingredients.some(ing => ing === searchTerm || (ingredientSynonyms[ing] === searchTerm));
                    }
                }
            });

            // Filtrera för Veg och Svenska om aktiverat
            if (isVegFilterActive) {
                filteredData = filteredData.filter(row => row[6]?.toLowerCase() === 'ja');
            }
            if (isLangFilterActive) {
                filteredData = filteredData.filter(row => row[7]?.toLowerCase() === 'ja');
            }

            displayData(filteredData);
        }




        function addTagFromButton() {
            const inputField = document.getElementById('searchInput');
            const input = inputField.value.trim().toLowerCase();

            if (searchForDishes) {
                console.log("Lägg till knappen är inaktiv när sökning på maträtter är aktiverad");
                return;
            }

            if (input && !selectedTags.includes(input)) {
                selectedTags.push(input);
                updateTagContainer();
            }

            inputField.value = ''; // Rensa inputfältet
        }

        function toggleVegFilter() {
            let vegSwitch = document.getElementById('vegSwitch');
            isVegFilterActive = vegSwitch.checked;
        }

        function toggleLangFilter() {
            let langSwitch = document.getElementById('langSwitch');
            isLangFilterActive = langSwitch.checked;
        }

        function toggleSearchMode() {
            const searchModeSwitch = document.getElementById('searchModeSwitch');
            searchForDishes = searchModeSwitch.checked;
            if (searchForDishes) {
                console.log("Sökning på maträtter aktiverad");
            } else {
                console.log("Sökning på ingredienser aktiverad");
            }
        }

        document.getElementById('searchInput').addEventListener('keydown', function (event) {
            if (event.key === 'Enter') {
                event.preventDefault();
                const input = this.value.trim().toLowerCase();

                // Om sökning på maträtter är aktiverad, utför sökningen direkt.
                if (searchForDishes) {
                    performSearch();
                    return;
                }

                // Lägg till tagg om möjligt och utför sökning.
                if (input && !selectedTags.includes(input)) {
                    selectedTags.push(input);
                    updateTagContainer();
                }

                performSearch(); // Utför sökningen direkt efter att en tagg har lagts till eller söktermen angivits.
                this.value = ''; // Rensa inputfältet
            }
        });







        function updateTagContainer() {
            const container = document.querySelector('.tag-container');
            container.innerHTML = selectedTags.map(tag => `
        <div class="tag">
            ${tag}
            <button class="tag-close" onclick="removeTag('${tag}')">×</button>
        </div>
    `).join('');
        }

        function displayData(data) {
            var htmlContent = '';
            data.forEach((row, index) => {
                htmlContent += `<div class="matratt">`;
                htmlContent += `<div class="matratt-title"><h2>${row[0]}</h2></div>`; // Maträttens namn

                // Knapp för att visa ingredienser
                htmlContent += `<button class="ingrediens-knapp" onclick="toggleIngredienser(this)">Visa Ingredienser</button>`;

                // Rullista för ingredienser med mouseleave-händelse
                htmlContent += `<div class="ingrediens-lista" onmouseleave="hideIngredienser(this)">${row[1].split(', ').join('<br>')}</div>`;

                htmlContent += row[5]; // Instagram-inlägg
                htmlContent += '</div>';
            });
            document.getElementById('data-container').innerHTML = htmlContent;

            // Processa Instagram-inlägg
            if (window.instgrm) {
                window.instgrm.Embeds.process();
            }
        }

        function toggleIngredienser(button) {
            var ingrediensLista = button.nextElementSibling;
            ingrediensLista.style.display = ingrediensLista.style.display === 'block' ? 'none' : 'block';
        }

        function hideIngredienser(ingrediensLista) {
            ingrediensLista.style.display = 'none';
        }



        window.onload = loadData;

        let lastScrollTop = 0;
        const backgroundContainer = document.querySelector('.background-container');
        const searchContainer = document.querySelector('.search-container');
        let atTop = true; // En ny variabel för att hålla reda på om användaren är vid toppen

        window.addEventListener('DOMContentLoaded', function () {
            const backgroundContainer = document.querySelector('.background-container');
            const searchContainer = document.querySelector('.search-container');
            let lastScrollTop = 0;

            window.addEventListener("scroll", function () {
                var currentScroll = window.pageYOffset || document.documentElement.scrollTop;
                const dataContainer = document.getElementById('data-container');

                // Om det finns sökresultat visas
                if (dataContainer && dataContainer.innerHTML.trim() !== '') {
                    if (currentScroll > lastScrollTop) {
                        // Scroll nedåt genom sökresultaten
                        searchContainer.classList.add('hidden-search');
                        backgroundContainer.classList.add('blur-background');
                    } else if (currentScroll <= 0) {
                        // Scroll uppåt till toppen av sökresultatsidan
                        searchContainer.classList.remove('hidden-search');
                        backgroundContainer.classList.remove('blur-background');
                    }
                } else {
                    // På startsidan, ingen suddighet eller döljning när man scrollar
                    searchContainer.classList.remove('hidden-search');
                    backgroundContainer.classList.remove('blur-background');
                }
                lastScrollTop = currentScroll <= 0 ? 0 : currentScroll;
            }, false);
        });



        function removeTag(tagToRemove) {
            selectedTags = selectedTags.filter(tag => tag !== tagToRemove);
            updateTagContainer(); // Uppdaterar taggkontainern
            performSearch(); // Utför en ny sökning med uppdaterade taggar
        }



    </script>

    <script async src="//www.instagram.com/embed.js"></script>

    <div class="footer-banner">
        <p class="copyright">&copy; 2023. All rights reserved.</p>
        <div class="footer-links">
            <a href="omoss.html">Om Oss</a>
            <a href="tipsaoss.html">Tipsa Oss</a>
        </div>
    </div>
</body>

</html>